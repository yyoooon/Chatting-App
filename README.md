
## 실행 방법
- 폴더를 편집기에 열고 터미널에 `yarn install` `yarn start` 명령을 실행해주세요. 
- 개발자 도구에서 모바일 사이즈로 보시는걸 권장합니다. 
- 데이터는 로컬 스토리지에 저장됩니다. 데이터를 초기화하고 싶다면 개발자 도구에서 직접 지워주세요.

</br>

## 배포 링크
https://chatting-pi.vercel.app/list

</br>

## 기술 스택
- React
- Typescript
- Emotion
- React Router Dom

</br>

## 구현내용

### 요구 사항 체크 리스트
```
 채팅 목록
    ✅ 각 채팅목록에는 최근 전송한 메세지, 읽지 않은 메세지 갯수, 마지막 메시지 전송 시간 표시하기.

 채팅방
    ✅ 메시지 전송 시간은 `hh:mm` 포맷으로 설정하기.
    ✅ 한 사람이 1분 동안 메시지를 연속해서 보낸다면, 마지막 메시지만 전송 시간 표시하기.
    ✅ 날짜가 바뀌면 날짜 구분선 표시하기.
    ✅ 사진 전송 기능을 구현하기.

 API
    ✅ 서버에 데이터를 요청해 받아오는 가상의 메소드를 만들기.

 인터랙션 애니메이션
   ✅ 화면 전환 시의 애니메이션 구현
   [] 사진 선택 애니메이션
```

</br>

### 🛠 가상 api구현

로컬 스토리지에 데이터를 저장하고 조작해 서버처럼 이용했습니다.
메세지를 보내면 **해당 채팅 방뿐만 아닌 전체 목록 리스트 페이지도 반영**되게 구현했습니다. (최신 메세지 컨텐츠와 시간, 최신순 정렬)


**1. 데이터 로드**
`getChattingList` `getChattingRoom`
- 페이지 **첫 로드 시에 로컬 스토리지에 데이터가 있다면** 그걸 가져다 쓰고,
- 없으면 **초기 데이터를 먼저 저장한 후 받아와서 사용**하도록 구현했습니다.
- 스토리지에서 받아온 데이터를 **최신 업데이트 순으로 정렬**한 후 반환하게 했습니다. 이에 따라 **최근에 대화한 채팅방부터 순차적으로 렌더링**됩니다.

**2. 데이터 생성**
`setInitialChattingList` `setInitialChattingRoom` `postChatting`
- **기존 데이터**를 가져와서 **바뀐 부분만 접근해 새로운 데이터로 업데이트 **한 후, 다시 통째로 **재할당하는** 방식으로 구현했습니다.

**3. 데이터 삭제**
`removeNoReadCount`
- **기존 데이터**를 가져와서 **바뀐 부분만 접근해 데이터를 비우고 다시 저장**하는 방식으로 구현.

</br>

### 🛠 날짜, 시간 관리하기
시간은 new Date객체의 반환 값인 타임스탬프로 설정합니다.

- 생성할 때 - `+new Date("2022-03-13 15:23:37")` 의 반환값인 타임스탬프로 저장
- 사용할 때 -  `new Intl.DateTimeFormat` `.format(new Date(받아온 타임스탬프))`
- `년-월-일` `시간:분` 의 형태로 포맷팅합니다.
- 포맷된 데이터로 메세지들 간의 날짜/시간 또는 현재 날짜/시간과 비교해 조건부 ui렌더링을 구현할 수 있습니다.

```tsx
new Intl.DateTimeFormat("ko", { dateStyle: 'long' }).format(new Date())
// '2022년 3월 8일'
new Intl.DateTimeFormat("ko", { timeStyle: 'short' }).format(new Date())
// '오후 10:58'
```

</br>

### 🛠 채팅 목록 렌더링

- 스토리지에서 받은 데이터를 최신 업데이트 시간 순으로 정렬한 후 채팅 목록을 렌더링합니다.
- 마지막 채팅 날짜가 오늘일 시 시간, 오늘이 아닐 시 날짜로 표시합니다.
- 채팅 창을 클릭하면 스토리지의 데이터를 업데이트 합니다. (안 읽은 갯수 0으로 변환)
- 이후 해당 id의 채팅방 페이지로 넘어갑니다.

</br>

###  🛠 채팅 대화 목록 렌더링
해당 채팅방의 모든 메세지 목록을 불러와서 렌더링합니다.

- 보낸 메세지와 받은 메세지를 다르게 스타일링 합니다.
- 데이터를 순환하며 **현재 메세지와 다음 메세지의 생성 날짜와 시간을 비교**합니다.
    - 날짜가 다르면 날짜 구분선까지 렌더링합니다.
    - 분이 같다면 시간을 표시하지 않습니다.


</br>

### 🛠 메세지 보내기 

- 스토리지에 해당 채팅방 메세지 목록을 업데이트 합니다.
- 모든 채팅방 리스트 데이터에서 해당 id인 값을 찾아 마지막 메세지 내용과 업데이트 시간을 변경해줍니다. (채팅 리스트 페이지 업데이트를 위해)
```ts
    // 전체 목록 불러와서 메세지 보낼 때마다 업데이트
    
    const chattingListData = getStorage('chattingList');

    chattingListData[id].upDateAt = 메세지 보낸 시간
    chattingListData[id].lastMessageContent = 마지막 메세지
    
    setStorage(chattingListData);
```

3. 상태 또한 업데이트 하므로써 채팅 메세지들을 리렌더링해 화면에 반영합니다.

</br>

### 🛠 이미지 추가
- 업로드 아이콘을 눌러 이미지 목록을 엽니다.
- 이미지를 클릭하면 스토리지의 보낸 메세지 목록에 업데이트합니다.
- 상태 또한 업데이트 하므로써 채팅 메세지들을 리렌더링 해 화면에 반영합니다.

</br>

### 🛠 애니메이션

- **화면 전환**: react-transition-group 라이브러리 이용
- **요소**: keyframe이용

</br>

## 고민한 부분

- 컴포넌트 폴더 구조와 네이밍을 어떻게 깔끔하고 명확하게 할지 고민했습니다.
  > ChattingList와 ChattingRoom으로 크게 나누고 그 안에서 
     각 도메인에 맞게 세부적으로 관리했습니다.

- 상대방 채팅과 내 채팅을 어떻게 구분해서 관리하고 어떻게 각각 다르게 렌더링할지 고민했습니다. 
  > 같은 데이터 구조로 type과 user를 다르게 받아 조건부 ui렌더링했습니다.

- 채팅 보낼 시 어떻게 전체 리스트까지 수정할지 고민했습니다.
  > 채팅 방의 id로 전체 리스트에서 해당 채팅방의 데이터를 찾아서 조작했습니다.
- 데이터를 저장할 때 시간 날짜를 어떻게 저장하고, 가져와서 어떻게 포맷할지 고민했습니다.
  > Date객체, TimeStemp, Intl.DateTimeFormat을 사용했습니다.


- 최신순 정렬을 post할 때 정렬하고 저장할 지, get할 때 정렬하고 가져올지 고민했습니다.
  > post api에 이미 복잡한 로직이 많았기에 get에 위임했습니다.
